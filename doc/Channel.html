<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Channel
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Channel";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo;
    
    
    <span class="title">Channel</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Channel
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">App</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">App</li>
          
            <li class="next">Channel</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>routes/channel/channel.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Channel routes</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET____channel_id_-instance_route" title="#GET &#39;/:channel_id&#39; (instance route)">#<strong>GET &#39;/:channel_id&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /:channel_id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET____channel_id_adminpage_-instance_route" title="#GET &#39;/:channel_id/adminpage&#39; (instance route)">#<strong>GET &#39;/:channel_id/adminpage&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /:channel_id/adminpage.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#GET__r___________new_hot_controversial_random__-instance_route" title="#GET %r{/([^/]+)/(new|hot|controversial|random)} (instance route)">#<strong>GET %r{/([^/]+)/(new|hot|controversial|random)}</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /:channel_id/:sorting.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST____channel_id_add_user_role_-instance_route" title="#POST &#39;/:channel_id/add_user_role&#39; (instance route)">#<strong>POST &#39;/:channel_id/add_user_role&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /:channel_id/add_user_role.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST____channel_id_create_role_-instance_route" title="#POST &#39;/:channel_id/create_role&#39; (instance route)">#<strong>POST &#39;/:channel_id/create_role&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /:channel_id/create_role.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST____channel_id_remove_user_role_-instance_route" title="#POST &#39;/:channel_id/remove_user_role&#39; (instance route)">#<strong>POST &#39;/:channel_id/remove_user_role&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /:channel_id/remove_user_role.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST____channel_id_update_role_permissions_-instance_route" title="#POST &#39;/:channel_id/update_role_permissions&#39; (instance route)">#<strong>POST &#39;/:channel_id/update_role_permissions&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /:channel_id/update_role_permissions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#POST___new_-instance_route" title="#POST &#39;/new&#39; (instance route)">#<strong>POST &#39;/new&#39;</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /new.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="GET____channel_id_-instance_route">
  
    #<strong>GET &#39;/:channel_id&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /:channel_id</p>

<p>Redirects to a random post in the specified channel.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>GET /channel/123</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 48</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:channel_id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/channel/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>/random</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET____channel_id_adminpage_-instance_route">
  
    #<strong>GET &#39;/:channel_id/adminpage&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /:channel_id/adminpage</p>

<p>Displays the admin page for the specified channel.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>GET /channel/123/adminpage</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 112</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:channel_id/adminpage</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not authorized</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='comment'># Ensure user is logged in
</span>
  <span class='ivar'>@channel</span> <span class='op'>=</span> <span class='const'>ChannelModel</span><span class='period'>.</span><span class='id identifier rubyid_get_channel_from_id'>get_channel_from_id</span><span class='lparen'>(</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>
  <span class='ivar'>@channel_id</span> <span class='op'>=</span> <span class='id identifier rubyid_channel_id'>channel_id</span>

  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>404</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Does not exist</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='ivar'>@channel</span> <span class='comment'># Ensure user is logged in
</span>
  <span class='comment'># Fetch permissions for the user in this channel
</span>  <span class='id identifier rubyid_permissions'>permissions</span> <span class='op'>=</span> <span class='const'>ChannelMembershipModel</span><span class='period'>.</span><span class='id identifier rubyid_permissions_for'>permissions_for</span><span class='lparen'>(</span><span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='ivar'>@roles</span> <span class='op'>=</span> <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_get_all_editable_roles'>get_all_editable_roles</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='ivar'>@users_with_roles</span> <span class='op'>=</span> <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_users_with_editable_roles'>users_with_editable_roles</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='ivar'>@permissions</span> <span class='op'>=</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_get_all_removeable_permissions'>get_all_removeable_permissions</span>

  <span class='id identifier rubyid_permission_names'>permission_names</span> <span class='op'>=</span> <span class='id identifier rubyid_permissions'>permissions</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span> <span class='comment'># Extract permission names
</span>
  <span class='comment'># Define the required permissions for access
</span>  <span class='id identifier rubyid_required_permissions'>required_permissions</span> <span class='op'>=</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>adminpage</span><span class='words_sep'> </span><span class='tstring_content'>owner</span><span class='tstring_end'>]</span></span>

  <span class='comment'># Check if user has any of the required permissions
</span>  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not authorized</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_permission_names'>permission_names</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_required_permissions'>required_permissions</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='comment'># Render admin page
</span>  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:&quot;channel/adminpage&quot;</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GET__r___________new_hot_controversial_random__-instance_route">
  
    #<strong>GET %r{/([^/]+)/(new|hot|controversial|random)}</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /:channel_id/:sorting</p>

<p>Displays posts in the specified channel, sorted by the given criteria.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>GET /channel/123/new</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 62</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>/([^/]+)/(new|hot|controversial|random)</span><span class='regexp_end'>}</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='id identifier rubyid_sorting'>sorting</span><span class='op'>|</span>
  <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='const'>ChannelModel</span><span class='period'>.</span><span class='id identifier rubyid_get_channel_from_id'>get_channel_from_id</span><span class='lparen'>(</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>404</span> <span class='kw'>unless</span> <span class='id identifier rubyid_channel'>channel</span>

  <span class='ivar'>@limit</span> <span class='op'>=</span> <span class='int'>10</span>
  <span class='ivar'>@offset</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='ivar'>@order_by</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_sorting'>sorting</span> <span class='comment'># rubocop:disable Style/HashLikeCase
</span>              <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>post.created_at DESC</span><span class='tstring_end'>&#39;</span></span>
              <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hot</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>post.created_at ASC</span><span class='tstring_end'>&#39;</span></span>
              <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>controversial</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>downvotes DESC</span><span class='tstring_end'>&#39;</span></span>
              <span class='kw'>end</span>

  <span class='ivar'>@random_order</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_sorting'>sorting</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random</span><span class='tstring_end'>&#39;</span></span>

  <span class='comment'># Special handling for random sorting
</span>  <span class='ivar'>@seed</span> <span class='op'>=</span> <span class='ivar'>@random_order</span> <span class='op'>?</span> <span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>25_000</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>nil</span>

  <span class='ivar'>@channel_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbracket'>]</span>

  <span class='ivar'>@search_query</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:search</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='kw'>nil</span>

  <span class='ivar'>@channel_id</span> <span class='op'>=</span> <span class='id identifier rubyid_channel_id'>channel_id</span>
  <span class='ivar'>@name</span> <span class='op'>=</span> <span class='id identifier rubyid_channel'>channel</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@description</span> <span class='op'>=</span> <span class='id identifier rubyid_channel'>channel</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>description</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@created_at</span> <span class='op'>=</span> <span class='id identifier rubyid_channel'>channel</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>created_at</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='ivar'>@posts</span> <span class='op'>=</span> <span class='const'>PostModel</span><span class='period'>.</span><span class='id identifier rubyid_retrieve_posts'>retrieve_posts</span><span class='lparen'>(</span>
    <span class='label'>offset:</span> <span class='ivar'>@offset</span><span class='comma'>,</span>
    <span class='label'>limit:</span> <span class='ivar'>@limit</span><span class='comma'>,</span>
    <span class='label'>order_by:</span> <span class='ivar'>@order_by</span><span class='comma'>,</span>
    <span class='label'>channel_ids:</span> <span class='ivar'>@channel_ids</span><span class='comma'>,</span>
    <span class='label'>search_query:</span> <span class='ivar'>@search_query</span><span class='comma'>,</span>
    <span class='label'>random_order:</span> <span class='ivar'>@random_order</span><span class='comma'>,</span>
    <span class='label'>seed:</span> <span class='ivar'>@seed</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:&quot;posts/channel&quot;</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST____channel_id_add_user_role_-instance_route">
  
    #<strong>POST &#39;/:channel_id/add_user_role&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /:channel_id/add_user_role</p>

<p>Adds a role to a user within the specified channel.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>POST /channel/123/add_user_role</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233
234
235
236
237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 231</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:channel_id/add_user_role</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='id identifier rubyid_user_has_permission?'>user_has_permission?</span><span class='lparen'>(</span><span class='qwords_beg'>%w[</span><span class='tstring_content'>owner</span><span class='words_sep'> </span><span class='tstring_content'>adminpage</span><span class='tstring_end'>]</span></span><span class='comma'>,</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_username'>username</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_role_id'>role_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:role_id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>UserModel</span><span class='period'>.</span><span class='id identifier rubyid_find_by_username'>find_by_username</span><span class='lparen'>(</span><span class='label'>username:</span> <span class='id identifier rubyid_username'>username</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>404</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>User not found</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_user'>user</span>

  <span class='const'>ChannelMembershipModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>user_id:</span> <span class='id identifier rubyid_user'>user</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>channel_role_id:</span> <span class='id identifier rubyid_role_id'>role_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST____channel_id_create_role_-instance_route">
  
    #<strong>POST &#39;/:channel_id/create_role&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /:channel_id/create_role</p>

<p>Creates a role within the specified channel.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>POST /channel/123/create_role</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


275
276
277
278
279
280
281
282
283</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 275</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:channel_id/create_role</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='id identifier rubyid_user_has_permission?'>user_has_permission?</span><span class='lparen'>(</span><span class='qwords_beg'>%w[</span><span class='tstring_content'>owner</span><span class='words_sep'> </span><span class='tstring_content'>adminpage</span><span class='tstring_end'>]</span></span><span class='comma'>,</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_role_name'>role_name</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:role_name</span><span class='rbracket'>]</span>

  <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='id identifier rubyid_role_name'>role_name</span><span class='comma'>,</span> <span class='label'>editable:</span> <span class='int'>1</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST____channel_id_remove_user_role_-instance_route">
  
    #<strong>POST &#39;/:channel_id/remove_user_role&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /:channel_id/remove_user_role</p>

<p>Removes a role from a user within the specified channel.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>POST /channel/123/remove_user_role</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255
256
257
258
259
260
261
262
263
264</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 253</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:channel_id/remove_user_role</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='id identifier rubyid_user_has_permission?'>user_has_permission?</span><span class='lparen'>(</span><span class='qwords_beg'>%w[</span><span class='tstring_content'>owner</span><span class='words_sep'> </span><span class='tstring_content'>adminpage</span><span class='tstring_end'>]</span></span><span class='comma'>,</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_role_id'>role_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:role_id</span><span class='rbracket'>]</span>

  <span class='comment'># user = UserModel.find_by_username(username: username)
</span>  <span class='comment'># halt 404, &#39;User not found&#39; unless user
</span>
  <span class='const'>ChannelMembershipModel</span><span class='period'>.</span><span class='id identifier rubyid_remove_role_from_user'>remove_role_from_user</span><span class='lparen'>(</span><span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>channel_role_id:</span> <span class='id identifier rubyid_role_id'>role_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST____channel_id_update_role_permissions_-instance_route">
  
    #<strong>POST &#39;/:channel_id/update_role_permissions&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /:channel_id/update_role_permissions</p>

<p>Updates the permissions for a specific role within the specified channel.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>POST /channel/123/update_role_permissions</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 198</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:channel_id/update_role_permissions</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='op'>|</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>403</span> <span class='kw'>unless</span> <span class='id identifier rubyid_user_has_permission?'>user_has_permission?</span><span class='lparen'>(</span><span class='qwords_beg'>%w[</span><span class='tstring_content'>owner</span><span class='words_sep'> </span><span class='tstring_content'>adminpage</span><span class='tstring_end'>]</span></span><span class='comma'>,</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_role_name'>role_name</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:role_name</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_permission_name'>permission_name</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:permission</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_add_permission'>add_permission</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:add</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span>

  <span class='comment'># Find the role ID from the role name
</span>  <span class='id identifier rubyid_role_id'>role_id</span> <span class='op'>=</span> <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name_and_group'>find_id_by_name_and_group</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='id identifier rubyid_role_name'>role_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>404</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Role not found</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_role_id'>role_id</span>

  <span class='comment'># Find the permission ID
</span>  <span class='id identifier rubyid_permission_id'>permission_id</span> <span class='op'>=</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name'>find_id_by_name</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='id identifier rubyid_permission_name'>permission_name</span><span class='rparen'>)</span> <span class='comment'># db.execute(&#39;SELECT id FROM permission WHERE name = ? LIMIT 1&#39;, permission_name).first&amp;.dig(&#39;id&#39;)
</span>  <span class='id identifier rubyid_halt'>halt</span> <span class='int'>404</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Permission not found</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_permission_id'>permission_id</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_add_permission'>add_permission</span>
    <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_add_permission'>add_permission</span><span class='lparen'>(</span><span class='label'>role_id:</span> <span class='id identifier rubyid_role_id'>role_id</span><span class='comma'>,</span> <span class='label'>permission_id:</span> <span class='id identifier rubyid_permission_id'>permission_id</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_remove_permission'>remove_permission</span><span class='lparen'>(</span><span class='label'>role_id:</span> <span class='id identifier rubyid_role_id'>role_id</span><span class='comma'>,</span> <span class='label'>permission_id:</span> <span class='id identifier rubyid_permission_id'>permission_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="POST___new_-instance_route">
  
    #<strong>POST &#39;/new&#39;</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /new</p>

<p>Creates a new channel with the provided title and description.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code>POST /channel/new</code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'routes/channel/channel.rb', line 150</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/new</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_description'>description</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:description</span><span class='rbracket'>]</span>

  <span class='comment'># Seed groups
</span>  <span class='id identifier rubyid_channel_id'>channel_id</span> <span class='op'>=</span> <span class='const'>ChannelModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>description:</span> <span class='id identifier rubyid_description'>description</span><span class='rparen'>)</span>

  <span class='comment'># Seed group-specific roles
</span>  <span class='id identifier rubyid_owner_role_id'>owner_role_id</span> <span class='op'>=</span> <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>editable:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Owner</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_moderator_role_id'>moderator_role_id</span> <span class='op'>=</span> <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Moderator</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_admin_role_id'>admin_role_id</span> <span class='op'>=</span> <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_member_role_id'>member_role_id</span> <span class='op'>=</span> <span class='const'>ChannelRoleModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Member</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># Assign permissions to roles
</span>  <span class='const'>RolePermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_role_id:</span> <span class='id identifier rubyid_owner_role_id'>owner_role_id</span><span class='comma'>,</span>
                             <span class='label'>permission_id:</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name'>find_id_by_name</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>delete_post</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>RolePermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_role_id:</span> <span class='id identifier rubyid_owner_role_id'>owner_role_id</span><span class='comma'>,</span>
                             <span class='label'>permission_id:</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name'>find_id_by_name</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ban_user</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>RolePermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_role_id:</span> <span class='id identifier rubyid_owner_role_id'>owner_role_id</span><span class='comma'>,</span>
                             <span class='label'>permission_id:</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name'>find_id_by_name</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>owner</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>RolePermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_role_id:</span> <span class='id identifier rubyid_admin_role_id'>admin_role_id</span><span class='comma'>,</span>
                             <span class='label'>permission_id:</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name'>find_id_by_name</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>adminpage</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>RolePermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_role_id:</span> <span class='id identifier rubyid_admin_role_id'>admin_role_id</span><span class='comma'>,</span>
                             <span class='label'>permission_id:</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name'>find_id_by_name</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>delete_post</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>RolePermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>channel_role_id:</span> <span class='id identifier rubyid_moderator_role_id'>moderator_role_id</span><span class='comma'>,</span>
                             <span class='label'>permission_id:</span> <span class='const'>PermissionModel</span><span class='period'>.</span><span class='id identifier rubyid_find_id_by_name'>find_id_by_name</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>delete_post</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>

  <span class='comment'># Assign users to groups with roles
</span>  <span class='const'>ChannelMembershipModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>channel_role_id:</span> <span class='id identifier rubyid_owner_role_id'>owner_role_id</span><span class='rparen'>)</span>
  <span class='const'>ChannelMembershipModel</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='label'>channel_id:</span> <span class='id identifier rubyid_channel_id'>channel_id</span><span class='comma'>,</span> <span class='label'>channel_role_id:</span> <span class='id identifier rubyid_member_role_id'>member_role_id</span><span class='rparen'>)</span>

  <span class='comment'># Save the channel to the database
</span>  <span class='comment'># db.execute(&#39;INSERT INTO channels (title, description) VALUES (?, ?)&#39;, [title, description])
</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/channel/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_channel_id'>channel_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Mar 17 00:02:43 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.3.2).
</div>

    </div>
  </body>
</html>